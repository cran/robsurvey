<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Beat Hulliger and Tobias Schoch" />

<meta name="date" content="2019-06-11" />

<title>Introduction to robsurvey</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Introduction to robsurvey</h1>
<h4 class="author">Beat Hulliger and Tobias Schoch</h4>
<h4 class="date">2019-06-11</h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>The package <strong>robsurvey</strong> provides several functions to compute robust survey statistics. The package supports the computations of robust means, totals, and ratios. Available methods are Huber M-estimators, trimming, and winsorization.</p>
<p>All methods may be used with <code>na.rm = TRUE</code> in order to remove missing values before the computation starts.</p>
<p>Most of the methods provided in the package are described in <span class="citation">(Hulliger 1995, <span class="citation">Hulliger (1999)</span>, <span class="citation">Hulliger et al. (2011)</span>, <span class="citation">Templ et al. (2011)</span>)</span>.</p>
<p><strong>robsurvey</strong> complements the popular <a href="https://cran.r-project.org/package=survey">survey</a> package.</p>
<p>Multivariate outlier detection and imputation methods can be found in the R-package <a href="https://cran.r-project.org/package=modi">modi</a>.</p>
</div>
<div id="overview" class="section level2">
<h2>Overview</h2>
<p>The main functions provided in <strong>robsurvey</strong> are:</p>
<ul>
<li><code>svymean_huber()</code></li>
<li><code>svytotal_huber()</code></li>
<li><code>svymean_trimmed()</code></li>
<li><code>svytotal_trimmed()</code></li>
<li><code>svymean_winsorized()</code></li>
<li><code>svytotal_winsorized()</code></li>
<li><code>weighted_line()</code></li>
<li><code>weighted_median_line()</code></li>
<li><code>weighted_median_ratio()</code></li>
</ul>
</div>
<div id="robust-survey-statistics" class="section level2">
<h2>Robust survey statistics</h2>
<p>In the following example, we showcase a typical use of the package <strong>robsurvey</strong>. The data we use are from the package <strong>survey</strong> and describe the student performance in Californian schools. We will show different ways of how to compute a robust mean value for the Academic Performance Index (API) in 2000. The variable is denoted as <code>api00</code>. The following code chunk simply loads the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## load packages
<span class="kw">library</span>(robsurvey)
<span class="kw">library</span>(survey)

<span class="co"># load the api dataset</span>
<span class="kw">data</span>(api)</code></pre></div>
<p>The variables we are going to use are shown in the following table. <code>sname</code> denotes the name of the school and <code>stype</code> the type of school (E: elementary school, M: middle school, H: high school). As mentioned above, <code>api00</code> denotes the Academic Performance Index of the school. <code>pw</code> is the weight of the observation and <code>fpc</code> is the population size that is used for the finite population correction. Note that the variable <code>fpc</code> is the same for all schools of the same type (E, M, H).</p>
<table>
<thead>
<tr class="header">
<th align="left">sname</th>
<th align="left">stype</th>
<th align="right">api00</th>
<th align="right">pw</th>
<th align="right">fpc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Open Magnet: Center for Individual (Char</td>
<td align="left">E</td>
<td align="right">840</td>
<td align="right">44.21</td>
<td align="right">4421</td>
</tr>
<tr class="even">
<td align="left">Belvedere Elementary</td>
<td align="left">E</td>
<td align="right">516</td>
<td align="right">44.21</td>
<td align="right">4421</td>
</tr>
<tr class="odd">
<td align="left">Altadena Elementary</td>
<td align="left">E</td>
<td align="right">531</td>
<td align="right">44.21</td>
<td align="right">4421</td>
</tr>
<tr class="even">
<td align="left">Soto Street Elementary</td>
<td align="left">E</td>
<td align="right">501</td>
<td align="right">44.21</td>
<td align="right">4421</td>
</tr>
<tr class="odd">
<td align="left">Walnut Canyon Elementary</td>
<td align="left">E</td>
<td align="right">720</td>
<td align="right">44.21</td>
<td align="right">4421</td>
</tr>
<tr class="even">
<td align="left">Atherwood Elementary</td>
<td align="left">E</td>
<td align="right">805</td>
<td align="right">44.21</td>
<td align="right">4421</td>
</tr>
</tbody>
</table>
<p>Based on the function <code>svydesign</code> from the <strong>survey</strong> package, we can now define a survey design for these data. With the argument <code>strata</code> we can stratify the dataset into the three types of schools.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># define survey design</span>
dstrat &lt;-<span class="st"> </span><span class="kw">svydesign</span>(<span class="dt">id =</span> <span class="op">~</span><span class="dv">1</span>, <span class="dt">strata =</span> <span class="op">~</span>stype, <span class="dt">weights =</span> <span class="op">~</span>pw, 
                    <span class="dt">data =</span> apistrat, <span class="dt">fpc =</span> <span class="op">~</span>fpc)</code></pre></div>
<p>Having defined the survey design, it is now very easy to compute robust survey statistics with the functions provided in <strong>robsurvey</strong>. In the following code chunk, we first compute the robust Horvitz-Thompson M-estimator for the mean API. In addition, we compute the trimmed and winsorized (robust) Horvitz-Thompson mean. Note how the estimates and the corresponding standard errors vary. The scale estimate used in the Huber-type robust M-estimator is the median absolute deviation (MAD), which is rescaled to be consistent at the normal distribution, i.e. it is multiplied by the constant 1.4826. The default tuning constant of the Huber-type Horvitz-Thompson M-estimator is <code>k = 1.5</code>. However, in this example we manually set it to <code>k = 2</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># compute the robust Horvitz-Thompson M-estimator of the mean</span>
<span class="kw">svymean_huber</span>(<span class="op">~</span>api00, dstrat, <span class="dt">k =</span> <span class="dv">2</span>)
<span class="co">#&gt;          mean    SE</span>
<span class="co">#&gt; api00 662.907 8.926</span>

<span class="co"># compute the robust trimmed Horvitz-Thompson mean</span>
<span class="kw">svymean_trimmed</span>(<span class="op">~</span>api00, dstrat, <span class="dt">k =</span> <span class="dv">2</span>)
<span class="co">#&gt;          mean     SE</span>
<span class="co">#&gt; api00 655.362 11.568</span>

<span class="co"># compute the robust winsorized Horvitz-Thompson mean</span>
<span class="kw">svymean_winsorized</span>(<span class="op">~</span>api00, dstrat, <span class="dt">k =</span> <span class="dv">2</span>)
<span class="co">#&gt;          mean     SE</span>
<span class="co">#&gt; api00 640.599 11.568</span></code></pre></div>
<p>It is also possible to use <code>svymean_huber()</code> (or analogously, <code>svymean_trimmed()</code> or <code>svymean_winsorized()</code>) in combination with <code>svyby()</code> from the <strong>survey</strong> package in order to compute the robust sample means for all three groups (or strata).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Domain estimates</span>
<span class="kw">svyby</span>(<span class="op">~</span>api00, <span class="dt">by =</span> <span class="op">~</span>stype, <span class="dt">design =</span> dstrat, svymean_huber, <span class="dt">k =</span> <span class="dv">2</span>)
<span class="co">#&gt;   stype    api00       se</span>
<span class="co">#&gt; E     E 675.8750 11.72813</span>
<span class="co">#&gt; H     H 626.3659 13.59477</span>
<span class="co">#&gt; M     M 635.4545 15.05877</span></code></pre></div>
<p>Instead of the mean, you may be interested in computing the robust total:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># compute the robust HTE for the total</span>
<span class="kw">svytotal_huber</span>(<span class="op">~</span>api00, dstrat, <span class="dt">k =</span> <span class="dv">2</span>)
<span class="co">#&gt;         total       SE</span>
<span class="co">#&gt; api00 4106045 55289.86</span>

<span class="co"># compute the robust trimmed total</span>
<span class="kw">svytotal_trimmed</span>(<span class="op">~</span>api00, dstrat, <span class="dt">k =</span> <span class="dv">2</span>)
<span class="co">#&gt;         total       SE</span>
<span class="co">#&gt; api00 4059312 71652.89</span>

<span class="co"># compute the robust winsorized total</span>
<span class="kw">svytotal_winsorized</span>(<span class="op">~</span>api00, dstrat, <span class="dt">k =</span> <span class="dv">2</span>)
<span class="co">#&gt;         total       SE</span>
<span class="co">#&gt; api00 3967868 71652.89</span></code></pre></div>
<p>For simulations and as intermediate results, the above functions can also be used without the <strong>survey</strong> package. They then only deliver the bare estimate. We extract the weights from the survey design with <code>weights(dstrat)</code>. Note that the estimate is identical to <code>svymean_huber(~api00, dstrat, k = 2)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># bare-bone function to compute robust Horvitz-Thompson M-estimator of the mean</span>
<span class="kw">weighted_mean_huber</span>(apistrat<span class="op">$</span>api00, <span class="kw">weights</span>(dstrat), <span class="dt">k =</span> <span class="dv">2</span>)
<span class="co">#&gt; [1] 662.9068</span></code></pre></div>
</div>
<div id="robust-simple-linear-regression-and-ratio-estimator" class="section level2">
<h2>Robust simple linear regression and ratio estimator</h2>
<p>A weighted version of the resistant line function of base R (<code>line()</code>) is provided as <code>weighted_line()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># weighted resistant line</span>
out &lt;-<span class="st"> </span><span class="kw">weighted_line</span>(apistrat<span class="op">$</span>api00 <span class="op">~</span><span class="st"> </span>apistrat<span class="op">$</span>api99, <span class="dt">w =</span> <span class="kw">weights</span>(dstrat))

<span class="co"># what are coefficients?</span>
<span class="kw">coef</span>(out)
<span class="co">#&gt; [1] 88.4729242  0.9133574</span>

<span class="co"># plot data</span>
<span class="kw">plot</span>(apistrat<span class="op">$</span>api00 <span class="op">~</span><span class="st"> </span>apistrat<span class="op">$</span>api99)
<span class="kw">abline</span>(out, <span class="dt">col =</span> <span class="st">&quot;green&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Two median-based simple regression estimators are provided (<code>weighted_median_line()</code>). One which takes the weighted median of the centered ratios as the estimator for the slope (<code>type = &quot;slopes&quot;</code>) and one which replaces all sums in the least squares estimator formula for the slope by weighted medians (<code>type = &quot;products&quot;</code>).</p>
<p>The weighted median of ratios estimators are</p>
<p><span class="math display">\[b_{1, slopes}=M\left(\frac{y-M(y, w)}{x-M(x, w)}, w\right) \]</span> and <span class="math display">\[b_{0, slopes}=M(y-b_{1, slopes}\cdot x, w), \]</span> where <span class="math inline">\(M(x, w)\)</span> is a weighted median of a vector <span class="math inline">\(x\)</span> weighted with <span class="math inline">\(w\)</span>.</p>
<p>The weighted median of products estimators are</p>
<p><span class="math display">\[ b_{1, products}=\frac{M((y-M(y, w))(x-M(x, w)), w)}{M((x-M(x, w))^2, w)}\]</span> and <span class="math display">\[b_{0, products}=M(y-b_{1, products}\cdot x, w).\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># weighted median line based on slopes</span>
out_s &lt;-<span class="st"> </span><span class="kw">weighted_median_line</span>(apistrat<span class="op">$</span>api00 <span class="op">~</span><span class="st"> </span>apistrat<span class="op">$</span>api99, <span class="dt">w =</span> <span class="kw">weights</span>(dstrat))

<span class="co"># weighted median line based on products</span>
out_p &lt;-<span class="st"> </span><span class="kw">weighted_median_line</span>(apistrat<span class="op">$</span>api00 <span class="op">~</span><span class="st"> </span>apistrat<span class="op">$</span>api99, <span class="dt">w =</span> <span class="kw">weights</span>(dstrat), <span class="dt">type =</span> <span class="st">&quot;products&quot;</span>)

<span class="co"># what are coefficients?</span>
<span class="kw">coef</span>(out_s)
<span class="co">#&gt; [1] 86.7647059  0.9159664</span>
<span class="kw">coef</span>(out_p)
<span class="co">#&gt; [1] 86.5587687  0.9163807</span>

<span class="co"># plot data</span>
<span class="kw">plot</span>(apistrat<span class="op">$</span>api00 <span class="op">~</span><span class="st"> </span>apistrat<span class="op">$</span>api99)
<span class="kw">abline</span>(out_s, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)
<span class="kw">abline</span>(out_p, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>A weighted regression through the origin based on medians is provided in <code>weighted_median_ratio()</code>. These functions may be useful for detecting bivariate outliers, as estimators on their own or as starting values for iterated M-estimators.</p>
</div>
<div id="utility-functions" class="section level2">
<h2>Utility functions</h2>
<p>The <strong>robsurvey</strong> package provides several functions which may be used outside the package, in particular <code>weighted_median()</code> and <code>weighted_quantile()</code>. The full list of utility functions is as follows:</p>
<ul>
<li><code>weighted_median()</code></li>
<li><code>weighted_quantile()</code></li>
<li><code>weighted_mad()</code></li>
<li><code>weighted_total()</code></li>
<li><code>weighted_mean()</code></li>
</ul>
<p>The weighted median calculates a median from the weighted empirical cumulative distribution function. Undefiniteness is solved by taking the mean of the low and the high median. Weighted quantiles use the lower quantile in case of undefiniteness.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># compute weighted median for api00</span>
<span class="kw">weighted_median</span>(apistrat<span class="op">$</span>api00, <span class="kw">weights</span>(dstrat))
<span class="co">#&gt; [1] 668</span></code></pre></div>
</div>
<div id="references" class="section level2 unnumbered">
<h2>References</h2>
<div id="refs" class="references">
<div id="ref-Hulliger1995">
<p>Hulliger, Beat. 1995. “Outlier Robust Horvitz-Thompson Estimators.” <em>Survey Methodology</em> 21: 79–87.</p>
</div>
<div id="ref-Hulliger1999">
<p>———. 1999. “Simple and Robust Estimators for Sampling.” <em>ASA Proceedings of the Section on Survey Research Methods</em> 21. American Statistical Association: 54–63.</p>
</div>
<div id="ref-Hulliger2011">
<p>Hulliger, Beat, Andreas Alfons, Peter Filzmoser, Angelika Meraner, Tobias Schoch, and Matthias Templ. 2011. “R Programmes for Robust Procedures.” FP7-SSH-2007-217322 AMELI. <a href="http://ameli.surveystatistics.net" class="uri">http://ameli.surveystatistics.net</a>.</p>
</div>
<div id="ref-AMELI-D10-3">
<p>Templ, Matthias, Andreas Alfons, Peter Filzmoser, Monique Graf, Josef Holzer, Beat Hulliger, Alexander Kowarik, et al. 2011. “R Packages Plus Manual.” FP7-SSH-2007-217322 AMELI. <a href="http://ameli.surveystatistics.net" class="uri">http://ameli.surveystatistics.net</a>.</p>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
